# Session Log Viewer Web Interface - Requirements Document

**Project**: Claude Multi-Agent Research System - Session Log Viewer
**Version**: 1.0
**Date**: 2025-11-19
**Status**: Requirements Analysis Complete

---

## Executive Summary

The Session Log Viewer is a local web-based interface designed to explore, search, and analyze session logs generated by the Claude Multi-Agent Research System. The system currently generates structured logs in `logs/` directory containing conversation transcripts and tool invocation records across multiple sessions. Users need an intuitive way to search, filter, and group these logs by various dimensions (tools, agents, skills, topics) to understand research workflows, debug issues, and track topic evolution across sessions.

### Project Goals

1. **Easy Log Exploration**: Provide intuitive web UI for browsing session logs without command-line tools
2. **Multi-Dimensional Search**: Enable filtering by tool name, agent name, skill name, and research topics
3. **Cross-Session Topic Tracking**: Group and visualize how topics span multiple sessions
4. **Local-First Architecture**: Run entirely within project directory, no external services required
5. **Flexible Log Discovery**: Automatically find and parse log files regardless of viewer deployment location

### Success Criteria

- User can search 1,000+ session logs in < 2 seconds
- Topic grouping identifies cross-session patterns with 95%+ accuracy
- Web interface loads in < 3 seconds on standard hardware
- Zero configuration required after initial setup
- 100% local operation (no external API calls)

---

## Stakeholders

### Primary User: Claude Code Developer/Researcher

**Profile**: Technical user working with Claude Code project who generates extensive session logs through multi-agent research and spec workflow orchestration.

**Needs**:
- Quickly find sessions where specific tools/agents/skills were used
- Track how research topics evolved across multiple sessions
- Debug workflow issues by inspecting tool call sequences
- Identify patterns in agent behaviors and skill activations
- Export filtered results for further analysis

**Pain Points**:
- Currently must use grep/find commands to search logs
- No visual way to see cross-session topic relationships
- Difficult to identify all sessions related to a specific research topic
- JSON tool_calls.jsonl requires manual parsing
- No aggregated statistics or timeline views

### Secondary User: Future Collaborators

**Profile**: Developers joining the project who need to understand historical work.

**Needs**:
- Browse past research sessions to understand project evolution
- Identify which skills/agents were used for specific tasks
- Learn from past debugging sessions and workflow patterns

---

## Functional Requirements

### FR-001: Log File Discovery and Loading

**Priority**: High
**Description**: System must automatically discover and load all session log files from the `logs/` directory, regardless of where the web interface is deployed within the project.

**Acceptance Criteria**:
- WHEN the application starts THEN it discovers all `session_*_transcript.txt` files in logs directory
- WHEN the application starts THEN it discovers all `session_*_tool_calls.jsonl` files in logs directory
- FOR log directory path VERIFY it reads from `.claude/config.json` paths.logs field
- IF log files are missing or corrupted THEN system skips them with warning (does not crash)
- FOR each session VERIFY metadata extracted from filename format `session_YYYYMMDD_HHMMSS_*`
- FOR tool_calls.jsonl VERIFY parsing as JSONL format (one JSON object per line)
- WHEN transcript is parsed THEN session start time is extracted from header

**Technical Notes**:
- Use path resolution relative to project root
- Support symlinks to logs directory
- Implement incremental loading for large log sets (1,000+ sessions)

---

### FR-002: Session List View

**Priority**: High
**Description**: Display chronological list of all sessions with key metadata.

**Acceptance Criteria**:
- WHEN user views session list THEN each entry shows session ID, date/time, duration (if calculable)
- FOR each session VERIFY display of summary statistics: tool call count, unique tools used, agent count
- IF session contains errors/warnings THEN it is highlighted visually
- WHEN user sorts sessions THEN options include: date (newest/oldest), duration, tool count
- FOR large result sets VERIFY pagination (50 sessions per page)
- WHEN user clicks a session THEN they navigate to detailed transcript and tool calls view

**UI Requirements**:
- Clean tabular layout with responsive design
- Visual indicators for session type (research vs planning vs manual)
- Quick preview tooltip on hover showing first user message

---

### FR-003: Search and Filter - Tool Name

**Priority**: High
**Description**: Filter sessions by specific tools invoked during the session.

**Acceptance Criteria**:
- WHEN application loads THEN all unique tool names are extracted from tool_calls.jsonl files
- WHEN user views tool filter THEN they see searchable dropdown of all available tools
- WHEN user selects multiple tools THEN sessions using ANY of selected tools are shown
- FOR each tool in dropdown VERIFY display of usage count (e.g., "WebSearch (234)")
- WHEN filter is applied THEN session list updates in real-time
- WHEN viewing session details THEN tool call timeline is displayed

**Example Tools**:
- WebSearch, WebFetch, Read, Write, Grep, Glob, TodoWrite, Task (agent spawning)

---

### FR-004: Search and Filter - Agent Name

**Priority**: High
**Description**: Filter sessions by agents spawned during orchestration.

**Acceptance Criteria**:
- FOR tool_calls.jsonl VERIFY parsing of agent names from `{"agent": "researcher"}` field
- WHEN identifying agents VERIFY distinction between ORCHESTRATOR and spawned agents
- WHEN user filters by agent THEN dropdown shows all agent types
- WHEN viewing session details THEN agent execution timeline is displayed
- FOR agent relationships VERIFY highlighting of parent-child (orchestrator → agents)
- WHEN agent task fails THEN failure status is clearly marked

**Technical Notes**:
- Agent name found in `tool_calls.jsonl` field: `{"agent": "researcher"}`
- ORCHESTRATOR is special agent representing main Claude instance

---

### FR-005: Search and Filter - Skill Name

**Priority**: High
**Description**: Filter sessions by skill orchestration workflows.

**Acceptance Criteria**:
- WHEN detecting skills VERIFY identification of multi-agent-researcher and spec-workflow-orchestrator
- FOR skill detection VERIFY extraction from transcript patterns or tool call context
- WHEN user filters by skill THEN only sessions with active skill are shown
- WHEN viewing session details THEN skill workflow phases are displayed
- FOR skill status VERIFY display of completion status (partial vs complete)
- WHEN skill iterates THEN quality gate failures are identified

**Heuristics for Skill Detection**:
- multi-agent-researcher: Multiple researcher agent spawns + report-writer
- spec-workflow-orchestrator: Sequential spec-analyst → spec-architect → spec-planner

---

### FR-006: Search and Filter - Topic/Keyword

**Priority**: High
**Description**: Search sessions by topics discussed or research keywords.

**Acceptance Criteria**:
- WHEN user searches THEN full-text search executes across transcript.txt files
- FOR search VERIFY keyword extraction from user prompts and agent outputs
- WHEN user enters query THEN boolean operators (AND, OR, NOT) are supported
- WHEN results display THEN search terms are highlighted in session transcript view
- FOR results VERIFY ranking by relevance (keyword frequency, recency)
- WHEN user saves frequent searches THEN they become "topics" for grouping

**Implementation**:
- Case-insensitive search
- Support phrase matching with quotes ("MCP servers")
- Stemming for related terms (research, researching, researcher)

---

### FR-007: Cross-Session Topic Grouping

**Priority**: High
**Description**: Group sessions that discuss related topics across different dates/times.

**Acceptance Criteria**:
- FOR topic identification VERIFY use of keyword similarity (TF-IDF or simple co-occurrence)
- WHEN user views topics THEN topic clusters display as visual cards/groups
- WHEN viewing topic THEN timeline of sessions within topic group is shown
- FOR topic management VERIFY users can manually tag sessions with custom topics
- WHEN managing topics VERIFY support for topic renaming and merging
- WHEN exporting topic group VERIFY report includes session IDs, dates, summary

**Algorithm Options**:
1. **Simple**: User creates named topic, tags sessions manually
2. **Semi-Automatic**: Suggest related sessions when tagging based on keyword overlap
3. **Automatic**: Cluster sessions using keyword similarity (Phase 2 enhancement)

**UI Requirements**:
- Tag management interface (create, edit, delete topics)
- Drag-and-drop sessions into topic groups
- Color-coded topics for visual distinction
- Topic detail page showing all sessions, timeline, key terms

---

### FR-008: Session Detail View

**Priority**: High
**Description**: Display comprehensive details of a single session.

**Acceptance Criteria**:
- WHEN viewing session THEN full transcript with timestamp markers is displayed
- WHEN viewing session THEN tool call sequence with collapsible details is shown
- FOR agent transitions VERIFY highlighting of orchestrator → agent → orchestrator
- WHEN viewing tool call THEN input/output for each tool call is displayed
- FOR each tool VERIFY display of duration and success status
- WHEN viewing session THEN links to related sessions (same topic, same skill) are shown
- FOR code and JSON VERIFY syntax highlighting is applied

**Layout**:
- Split view: transcript on left, tool calls timeline on right
- Synchronized scrolling (clicking tool call scrolls to relevant transcript section)
- Expandable JSON viewer for tool inputs/outputs

---

### FR-009: Export and Sharing

**Priority**: Medium
**Description**: Export filtered results or specific sessions for analysis or sharing.

**Acceptance Criteria**:
- WHEN user clicks "Export" THEN current filtered session list downloads as CSV
- WHEN exporting individual session THEN formatted Markdown file is downloaded
- WHEN exporting topic group THEN combined report is generated
- WHEN user copies permalink THEN deep link to session view is in clipboard
- WHEN generating shareable HTML THEN standalone viewer for selected sessions is created

**Export Formats**:
- CSV: Session metadata table
- Markdown: Human-readable session report
- JSON: Machine-readable full session data
- HTML: Standalone viewer for offline sharing

---

### FR-010: Statistics and Analytics Dashboard

**Priority**: Medium
**Description**: Provide aggregate statistics and visualizations across all sessions.

**Acceptance Criteria**:
- WHEN viewing dashboard THEN total session count, date range, total tool calls are displayed
- WHEN viewing dashboard THEN most frequently used tools are shown in bar chart
- WHEN viewing dashboard THEN agent usage distribution is shown in pie chart
- WHEN viewing dashboard THEN skill activation timeline is shown in line chart over time
- FOR statistics VERIFY display of average session duration and tool calls per session
- WHEN viewing dashboard THEN busiest research days are shown in heatmap calendar

**Metrics**:
- Sessions per day/week/month
- Tool call distribution
- Agent success rate
- Skill completion rate
- Topic diversity (unique topics identified)

---

### FR-011: Advanced Filtering and Combinations

**Priority**: Medium
**Description**: Support complex filter combinations for precise queries.

**Acceptance Criteria**:
- WHEN user applies filters THEN multiple filter types can be combined (e.g., tool=WebSearch AND agent=researcher AND topic="MCP")
- WHEN user creates filter combination THEN they can save as preset for reuse
- WHEN filters are active THEN they display as removable chips/tags
- FOR date filtering VERIFY support for date range selection
- FOR duration filtering VERIFY support for sessions > specified duration (e.g., sessions > 5 minutes)
- WHEN user wants to exclude THEN NOT operator is supported for criteria

**UI Pattern**:
- Filter builder interface with AND/OR logic
- Visual query builder or advanced search syntax
- Clear all filters button

---

### FR-012: Session Comparison

**Priority**: Low
**Description**: Compare two or more sessions side-by-side.

**Acceptance Criteria**:
- WHEN user selects multiple sessions THEN comparison view can be opened
- WHEN comparing sessions THEN side-by-side transcript view with synchronized scrolling is shown
- FOR comparison VERIFY highlighting of differences in tool usage
- WHEN comparing THEN agent workflows are compared
- FOR comparison VERIFY identification of common topics/keywords

**Use Case**: Compare successful vs failed skill executions to identify patterns.

---

## Non-Functional Requirements

### NFR-001: Performance

**Description**: System must be responsive even with large log datasets.

**Metrics**:
- **Initial Load**: Web app loads in < 3 seconds (1,000 sessions)
- **Search Response**: < 2 seconds for keyword search across all transcripts
- **Filter Application**: < 500ms to update session list after filter change
- **Session Detail Load**: < 1 second to display full session transcript
- **Memory Usage**: < 500MB RAM for 1,000 sessions loaded in browser

**Implementation Strategies**:
- Lazy loading of session transcripts (load on-demand)
- Index tool calls and metadata for fast filtering
- Virtual scrolling for large session lists
- Web Workers for background parsing and search

---

### NFR-002: Usability

**Description**: Interface must be intuitive for technical users without training.

**Metrics**:
- **First-Time Use**: User can find specific session in < 60 seconds without documentation
- **Task Completion**: 90% success rate for common tasks (search by tool, filter by agent)
- **Error Recovery**: Clear error messages with actionable guidance

**Design Principles**:
- Familiar web UI patterns (search bar, filters sidebar, card/table layouts)
- Keyboard shortcuts for power users (/, Cmd+K for search)
- Responsive design (works on laptop screens 1366x768+)
- Accessible (WCAG 2.1 AA compliance for contrast, keyboard navigation)

---

### NFR-003: Reliability

**Description**: System must handle corrupted or incomplete log files gracefully.

**Metrics**:
- **Uptime**: Web server runs without crashes for 24+ hours
- **Error Handling**: Corrupt JSONL lines skipped with warning (not crash)
- **Data Integrity**: No data modification to original log files (read-only access)

**Fault Tolerance**:
- Validate JSON parsing with try-catch
- Display partial results if some files are unreadable
- Log parsing errors to browser console for debugging

---

### NFR-004: Maintainability

**Description**: Codebase should be easy to extend and modify.

**Metrics**:
- **Code Structure**: Modular components (log parser, search engine, UI components)
- **Documentation**: Inline code comments and README with architecture overview
- **Testing**: Unit tests for parsing logic, integration tests for search

**Technology Constraints**:
- Use modern JavaScript (ES6+) or TypeScript
- Minimal dependencies (prefer standard library)
- No build step required (or simple single-command build)

---

### NFR-005: Security

**Description**: Protect sensitive information in logs.

**Requirements**:
- **Local-Only**: No external network requests (all data stays on local machine)
- **Read-Only Access**: Web interface cannot modify or delete log files
- **No Authentication**: Not required (local single-user access assumed)
- **Sensitive Data**: Option to redact or blur sensitive strings (API keys, tokens) in UI

**Note**: Logs may contain prompts with sensitive project details. Entire application runs locally to prevent data leakage.

---

### NFR-006: Portability

**Description**: Application must work regardless of deployment location within project.

**Requirements**:
- **Path Independence**: Resolve log directory relative to project root or via config
- **Cross-Platform**: Works on macOS, Linux, Windows
- **Browser Compatibility**: Modern browsers (Chrome 90+, Firefox 88+, Safari 14+, Edge 90+)
- **No External Services**: No CDN dependencies, all assets bundled locally

**Deployment Options**:
1. **Static HTML + JS**: Open index.html directly in browser (with file:// protocol limitations)
2. **Local HTTP Server**: Simple Python/Node.js server (recommended)
3. **Embedded Server**: Packaged as single executable with embedded web server

---

### NFR-007: Scalability

**Description**: Handle growing log corpus over time.

**Metrics**:
- **Current Scale**: ~100 sessions (200 log files)
- **Target Scale**: 10,000 sessions (20,000 log files)
- **Max Scale**: 50,000 sessions before requiring database

**Scaling Strategy**:
- Phase 1: In-memory indexing (target scale)
- Phase 2: SQLite database for metadata (max scale)
- Incremental indexing (only parse new/modified files)

---

## User Stories

### Epic 1: Log Discovery and Viewing

#### Story US-001: Browse All Sessions

**As a** developer
**I want** to see a list of all my Claude Code sessions
**So that** I can quickly identify when I worked on specific tasks

**Acceptance Criteria**:
- **WHEN** I open the web interface **THEN** I see a paginated list of all sessions sorted by date (newest first)
- **WHEN** I hover over a session **THEN** I see a tooltip with the first user message
- **WHEN** I click on a session **THEN** I navigate to the detailed session view

**Story Points**: 3
**Priority**: High

---

#### Story US-002: View Session Details

**As a** developer
**I want** to view the full transcript and tool calls for a session
**So that** I can understand exactly what happened during that session

**Acceptance Criteria**:
- **WHEN** I view a session **THEN** I see the complete transcript with timestamps
- **WHEN** I view a session **THEN** I see all tool calls in chronological order
- **WHEN** I click on a tool call **THEN** I see the full input and output JSON
- **IF** a tool call failed **THEN** it is highlighted in red with error details

**Story Points**: 5
**Priority**: High

---

### Epic 2: Search and Filtering

#### Story US-003: Search by Tool Name

**As a** developer
**I want** to find all sessions where a specific tool was used
**So that** I can analyze how that tool is being utilized

**Acceptance Criteria**:
- **WHEN** I select "WebSearch" from the tool filter **THEN** only sessions using WebSearch are shown
- **WHEN** I select multiple tools **THEN** sessions using ANY of those tools are shown
- **FOR** each tool **VERIFY** usage count is displayed (e.g., "WebSearch (234 sessions)")

**Story Points**: 3
**Priority**: High

---

#### Story US-004: Search by Agent

**As a** developer
**I want** to filter sessions by agent type
**So that** I can see how different agents (researcher, spec-analyst) are performing

**Acceptance Criteria**:
- **WHEN** I select "researcher" agent **THEN** only sessions that spawned researcher agents are shown
- **WHEN** viewing session details **THEN** I can see which tool calls came from which agent
- **IF** an agent task failed **THEN** the failure is clearly marked

**Story Points**: 5
**Priority**: High

**Technical Notes**:
- Parse `{"agent": "researcher"}` from tool_calls.jsonl
- Distinguish ORCHESTRATOR from spawned agents

---

#### Story US-005: Search by Keyword/Topic

**As a** developer
**I want** to search for sessions discussing a specific topic (e.g., "MCP servers")
**So that** I can find all related research work

**Acceptance Criteria**:
- **WHEN** I enter "MCP servers" in search box **THEN** all sessions mentioning "MCP servers" are shown
- **WHEN** I view a result **THEN** search terms are highlighted in the transcript
- **WHEN** I use quotes **THEN** exact phrase matching is used ("MCP servers" not "MCP" OR "servers")

**Story Points**: 5
**Priority**: High

**Technical Notes**:
- Full-text search across transcript.txt files
- Consider using browser-native search or lightweight JS library (lunr.js, fuse.js)

---

### Epic 3: Cross-Session Topic Tracking

#### Story US-006: Create Topic Group

**As a** developer
**I want** to create named topic groups and tag related sessions
**So that** I can track how a research topic evolved over time

**Acceptance Criteria**:
- **WHEN** I create a topic (e.g., "MCP Research") **THEN** I can tag sessions with that topic
- **WHEN** I view a topic **THEN** I see all tagged sessions in chronological order
- **WHEN** I tag a session **THEN** the system suggests other potentially related sessions based on keyword similarity

**Story Points**: 8
**Priority**: High

**Technical Notes**:
- Store topic-session mappings in localStorage or local JSON file
- Implement keyword similarity algorithm for suggestions

---

#### Story US-007: Visualize Topic Timeline

**As a** developer
**I want** to see a timeline visualization of sessions within a topic group
**So that** I can understand the temporal flow of research

**Acceptance Criteria**:
- **WHEN** I view a topic **THEN** I see a horizontal timeline with sessions as points
- **WHEN** I hover over a timeline point **THEN** I see session summary (date, key tools used)
- **WHEN** I click a timeline point **THEN** I navigate to that session's detail view

**Story Points**: 5
**Priority**: Medium

---

### Epic 4: Analytics and Insights

#### Story US-008: View Usage Statistics

**As a** developer
**I want** to see aggregate statistics about my Claude Code usage
**So that** I can understand my workflow patterns

**Acceptance Criteria**:
- **WHEN** I view the dashboard **THEN** I see total sessions, date range, total tool calls
- **WHEN** I view the dashboard **THEN** I see a bar chart of most used tools
- **WHEN** I view the dashboard **THEN** I see agent usage distribution
- **FOR** each metric **VERIFY** data is calculated from actual log files

**Story Points**: 5
**Priority**: Medium

---

#### Story US-009: Compare Sessions

**As a** developer
**I want** to compare two sessions side-by-side
**So that** I can identify differences in workflow or debugging approaches

**Acceptance Criteria**:
- **WHEN** I select 2+ sessions **THEN** I can open comparison view
- **WHEN** comparing **THEN** transcripts are shown side-by-side with synchronized scrolling
- **WHEN** comparing **THEN** tool usage differences are highlighted

**Story Points**: 8
**Priority**: Low

---

### Epic 5: Export and Sharing

#### Story US-010: Export Search Results

**As a** developer
**I want** to export filtered session list as CSV
**So that** I can analyze data in spreadsheet tools

**Acceptance Criteria**:
- **WHEN** I click "Export" **THEN** current filtered session list is downloaded as CSV
- **FOR** the CSV **VERIFY** columns include: Session ID, Date, Tools Used, Agents, Topics, Duration

**Story Points**: 3
**Priority**: Medium

---

#### Story US-011: Export Session as Markdown

**As a** developer
**I want** to export a session as formatted Markdown
**So that** I can share it in documentation or GitHub issues

**Acceptance Criteria**:
- **WHEN** I click "Export as Markdown" on a session **THEN** a .md file is downloaded
- **FOR** the Markdown **VERIFY** it includes formatted transcript and tool call summary
- **FOR** the Markdown **VERIFY** JSON is syntax highlighted in code blocks

**Story Points**: 5
**Priority**: Medium

---

## Technical Constraints

### TC-001: Technology Stack

**Constraint**: Use lightweight web technologies compatible with local deployment.

**Recommendations**:
- **Frontend**: Vanilla JavaScript or lightweight framework (Alpine.js, Preact, Vue 3)
- **Backend**: Simple HTTP server (Python http.server, Node.js Express, or none for static deployment)
- **Data Storage**: Browser localStorage for UI state and topic mappings
- **Build Tool**: Optional (prefer no-build if possible, or single-step build with Vite/esbuild)

---

### TC-002: Log File Format

**Constraint**: Must parse existing log format without modifications.

**Current Format**:
```
logs/
  session_20251117_224304_transcript.txt
  session_20251117_224304_tool_calls.jsonl
```

**transcript.txt Structure**:
```
Research Agent Session Log
Session ID: session_20251117_224304
Started: 2025-11-17T22:43:04.621721
================================================================================

[22:43:04] ORCHESTRATOR → TodoWrite ✅
  Input: {...}
  Output: Success
```

**tool_calls.jsonl Structure** (one JSON object per line):
```json
{"ts": "2025-11-17T22:43:04.621565", "agent": "ORCHESTRATOR", "tool": "TodoWrite", "input": {...}, "success": true, "output_size": null, "duration_ms": null}
```

---

### TC-003: Project Integration

**Constraint**: Integrate cleanly into existing project structure.

**Requirements**:
- Deploy in new directory: `web-viewer/` or `tools/log-viewer/`
- Read log path from `.claude/config.json` (line 5: `"logs": "logs"`)
- No modifications to existing log generation code
- Add to `.gitignore` if generated files are created (e.g., index database)

---

### TC-004: Browser Security Model

**Constraint**: File:// protocol has CORS restrictions.

**Implications**:
- **Static HTML approach**: Cannot use fetch() to load log files from disk
  - **Solution**: Require local HTTP server
- **Recommended**: Bundle simple Python or Node.js server script
  - Python: `python3 -m http.server 8080` (built-in)
  - Node.js: Simple Express server (requires npm install)

---

## Assumptions

1. **Log Files are Well-Formed**: Assume session files are generated by the project's logging system and follow documented format
2. **Single User**: Application designed for single-user local access (no multi-user considerations)
3. **Modern Browser**: User has Chrome/Firefox/Safari/Edge from last 2 years
4. **Logs Fit in Memory**: Combined size of metadata/index can fit in browser memory (< 500MB for 10,000 sessions)
5. **No Real-Time Updates**: Application parses logs at startup/refresh; no live-tailing of active sessions
6. **Session Files are Complete**: Each session has both transcript and tool_calls files (or gracefully handle missing)
7. **Local Network Available**: User can run local HTTP server on localhost:8080 (or similar)

---

## Out of Scope

### Explicitly NOT Included in v1.0

1. **Real-Time Session Monitoring**: Live view of currently active Claude session
2. **Log Editing/Deletion**: Web interface is read-only, cannot modify logs
3. **Authentication/Authorization**: No user login, session encryption, or access control
4. **Cloud Deployment**: No hosting on external servers, cloud storage integration
5. **Advanced Analytics**: No ML-based topic modeling, sentiment analysis, or predictive analytics
6. **Multi-Project Support**: Designed for single project's logs, no workspace/multi-repo view
7. **Log Aggregation**: No combining logs from multiple machines or users
8. **Version Control Integration**: No git blame, commit linking, or branch correlation
9. **Notification/Alerting**: No alerts for anomalies or long-running sessions
10. **Mobile App**: Web interface only, no native iOS/Android app

### Potential Future Enhancements (v2.0+)

- Automatic topic clustering using NLP (vs manual tagging)
- Export to Notion, Obsidian, or other knowledge management tools
- Plugin system for custom log parsers or visualizations
- Integration with project's quality gate validation results
- Differential view between sessions (like git diff)
- Session replay (step through tool calls interactively)

---

## Success Metrics

### Quantitative Metrics

| Metric | Target | Measurement Method |
|--------|--------|-------------------|
| Time to Find Session | < 60 seconds | User testing task: "Find session about MCP research from Nov 17" |
| Search Performance | < 2 seconds | Automated test: search 1,000 sessions for keyword |
| UI Load Time | < 3 seconds | Lighthouse performance audit |
| Cross-Session Topics Identified | 80% of known topics | Manual validation: compare auto-suggestions vs user's known topic groups |
| Zero Crashes | 24 hours continuous use | Stress test with large log corpus |

### Qualitative Metrics

| Metric | Target | Measurement Method |
|--------|--------|-------------------|
| User Satisfaction | "Very Satisfied" or "Satisfied" | Post-launch survey (1 question: rate 1-5) |
| Learnability | 90% task success without docs | Usability test: 3 users, 5 common tasks |
| Perceived Performance | "Fast" or "Very Fast" | User perception survey |

### Adoption Metrics

| Metric | Target | Measurement Method |
|--------|--------|-------------------|
| Daily Active Use | 5+ days per week | Self-reported usage log |
| Primary Search Method | 80% use web viewer vs grep | User interview: "How do you search logs now?" |

---

## Risk Analysis

### High-Priority Risks

| Risk | Impact | Probability | Mitigation Strategy |
|------|--------|-------------|---------------------|
| **Performance degradation with 10,000+ sessions** | High | Medium | Implement lazy loading, indexing, and consider SQLite for metadata at scale |
| **Browser memory limits exceeded** | High | Medium | Stream large transcripts, use virtual scrolling, profile memory usage early |
| **Log format changes break parser** | Medium | Low | Version log format in config.json, implement parser versioning |
| **CORS issues with file:// protocol** | Medium | High | Document local server requirement clearly in README, provide server scripts |
| **User has sensitive data in logs** | High | Low | Implement optional redaction patterns, warn users about sharing exported data |

### Medium-Priority Risks

| Risk | Impact | Probability | Mitigation Strategy |
|------|--------|-------------|---------------------|
| **Keyword search misses relevant sessions** | Medium | Medium | Implement stemming, fuzzy matching; allow user to tune search sensitivity |
| **Topic grouping requires too much manual work** | Medium | Medium | Prioritize auto-suggestion feature, make tagging quick (keyboard shortcuts) |
| **Complex UI overwhelms user** | Low | Medium | Iterative design with user feedback, progressive disclosure of features |

---

## Dependencies

### External Dependencies

- **Browser**: Modern web browser (no IE support required)
- **HTTP Server**: Python 3.6+ (built-in http.server) OR Node.js 14+ (for optional Express server)
- **Log Files**: Project's existing session logging system (`.claude/utils/session_logger.py`)

### Internal Dependencies

- **.claude/config.json**: Read `paths.logs` for log directory location
- **logs/**: Session log files (transcript.txt, tool_calls.jsonl)
- **Project Structure**: Must be deployed within project directory to resolve relative paths

### Optional Dependencies

- **Chart Library**: Chart.js or D3.js for analytics visualizations (could use vanilla SVG)
- **Search Library**: lunr.js or fuse.js for client-side full-text search (could use naive string matching for v1)
- **UI Framework**: Alpine.js, Preact, or Vue 3 (could use vanilla JS)

---

## Appendix A: Log Format Examples

### Sample transcript.txt

```
Research Agent Session Log
Session ID: session_20251117_224304
Started: 2025-11-17T22:43:04.621721
================================================================================


[22:43:04] ORCHESTRATOR → TodoWrite ✅
  Input: {
  "todos": [
    {
      "content": "Explore project structure to identify all agents and skills",
      "status": "completed",
      "activeForm": "Exploring project structure to identify all agents and skills"
    }
  ]
  }
  Output: Success
  Duration: Nonems
────────────────────────────────────────────────────────────────────────────────

[22:43:15] ORCHESTRATOR → Read ✅
  Input: {
    "file_path": "/Users/ahmedmaged/ai_storage/projects/..."
  }
  Output: (file content)
  Duration: 45ms
────────────────────────────────────────────────────────────────────────────────
```

### Sample tool_calls.jsonl

```json
{"ts": "2025-11-17T22:43:04.621565", "agent": "ORCHESTRATOR", "tool": "TodoWrite", "input": {"todos": [{"content": "Explore project structure", "status": "completed", "activeForm": "Exploring..."}]}, "success": true, "output_size": null, "duration_ms": null}
{"ts": "2025-11-17T22:43:15.123456", "agent": "ORCHESTRATOR", "tool": "Read", "input": {"file_path": "/Users/.../file.md"}, "success": true, "output_size": 1234, "duration_ms": 45}
{"ts": "2025-11-17T22:43:30.789012", "agent": "researcher", "tool": "WebSearch", "input": {"query": "MCP servers"}, "success": true, "output_size": 5678, "duration_ms": 1200}
```

---

## Appendix B: Configuration Reference

### .claude/config.json (relevant excerpt)

```json
{
  "paths": {
    "research_notes": "files/research_notes",
    "reports": "files/reports",
    "logs": "logs",
    "state": ".claude/state"
  },
  "logging": {
    "enabled": true,
    "format": "flat",
    "session_id_format": "session_%Y%m%d_%H%M%S",
    "log_tool_calls": true
  }
}
```

### Usage in Log Viewer

```javascript
// Example: Reading log path from config
const config = await fetch('../.claude/config.json').then(r => r.json());
const logDir = config.paths.logs; // "logs"
const logPath = `../${logDir}/`; // "../logs/"
```

---

## Appendix C: UI Mockup Descriptions

### Main Dashboard View

**Layout**:
- **Top Bar**: Logo/Title, Search bar (global keyword search), Filter button, Settings icon
- **Left Sidebar**: Filter panel (tools, agents, skills, date range, topics)
- **Main Content**: Session list (table or card grid)
  - Columns: Session ID, Date/Time, Duration, Tools Used (tags), Agents (tags), Topics (tags), Status
  - Pagination controls at bottom
- **Right Sidebar** (optional): Mini analytics (tool usage pie chart, sessions per day sparkline)

### Session Detail View

**Layout**:
- **Top Bar**: Back button, Session ID/Date, Export button (Markdown, JSON)
- **Split View**:
  - **Left Panel** (60% width): Transcript with timestamps, syntax highlighting
  - **Right Panel** (40% width): Tool call timeline (vertical list)
    - Each entry: Tool name, Agent, Timestamp, Success/Fail indicator
    - Click to expand input/output JSON
- **Bottom Bar**: Related sessions (same topic/skill)

### Topic Management View

**Layout**:
- **Top Bar**: "Create New Topic" button
- **Main Content**: Topic cards (3-column grid)
  - Each card: Topic name, Session count, Timeline mini-chart, Edit/Delete buttons
  - Click card to see topic detail page
- **Topic Detail Page**:
  - Timeline visualization (horizontal date axis, sessions as points)
  - Session list filtered to this topic
  - Key terms word cloud (optional)

---

## Appendix D: Implementation Phases

### Phase 1: Core Functionality (MVP)

**Scope**: Basic log viewing and search
- FR-001: Log file discovery
- FR-002: Session list view
- FR-003: Search by tool
- FR-006: Search by keyword
- FR-008: Session detail view
- NFR-001, 002, 003: Performance, usability, reliability

**Deliverables**:
- Working web interface
- Local HTTP server script
- README with setup instructions

**Timeline**: 2-3 weeks (single developer)

---

### Phase 2: Advanced Filtering and Topics

**Scope**: Multi-dimensional filtering and topic tracking
- FR-004: Filter by agent
- FR-005: Filter by skill
- FR-007: Cross-session topic grouping
- FR-011: Advanced filter combinations

**Deliverables**:
- Topic management UI
- Filter builder
- Topic export functionality

**Timeline**: 2 weeks

---

### Phase 3: Analytics and Polish

**Scope**: Visualizations and export
- FR-009: Export functionality
- FR-010: Analytics dashboard
- FR-012: Session comparison

**Deliverables**:
- Charts and visualizations
- Export to CSV/Markdown/JSON
- Session comparison view

**Timeline**: 1-2 weeks

---

### Phase 4: Optimization (Future)

**Scope**: Scalability and advanced features
- SQLite backend for large log corpus
- Automatic topic clustering (ML)
- Real-time session monitoring
- Plugin system

**Timeline**: TBD based on user feedback

---

## Document Revision History

| Version | Date | Author | Changes |
|---------|------|--------|---------|
| 1.0 | 2025-11-19 | spec-analyst (Claude) | Initial requirements document created |

---

**End of Requirements Document**

*This document serves as the foundation for architecture design and implementation planning. All requirements are subject to validation and refinement during the design phase.*
